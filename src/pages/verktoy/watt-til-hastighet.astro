---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Button from "../../components/Button.astro";
import Card from "../../components/Card.astro";

const title = "Watt → hastighet";
const description =
    "Beregn hastighet på flatmark basert på watt, CdA, rullemotstand og vekt.";
---

<BaseLayout {title} {description}>
    <h1 class="text-2xl font-semibold tracking-tight text-slate-50 sm:text-3xl">
        Watt → hastighet
    </h1>

    <p class="mt-2 text-sm text-slate-300">
        Kalkulator basert på balanse mellom luftmotstand og rullemotstand. Et
        realistisk estimat for flat løype.
    </p>

    <div class="mt-6 grid gap-6 md:grid-cols-2">
        <div class="space-y-4">
            <!-- WATT -->
            <div class="space-y-1 text-sm">
                <label class="text-slate-200">Watt</label>
                <input id="watt" type="number" value="250"
                       class="w-full rounded-xl border border-slate-700 bg-slate-950/80 px-3 py-2 text-sm" />
            </div>

            <!-- CdA -->
            <div class="space-y-1 text-sm">
                <label class="text-slate-200">CdA</label>
                <input id="cda" type="number" step="0.01" value="0.32"
                       class="w-full rounded-xl border border-slate-700 bg-slate-950/80 px-3 py-2 text-sm" />
                <p class="text-xs text-slate-400">Vanlig landevei: 0.25–0.35</p>
            </div>

            <!-- VEKT -->
            <div class="space-y-1 text-sm">
                <label class="text-slate-200">Totalvekt (kg)</label>
                <input id="weight" type="number" value="82" step="0.1"
                       class="w-full rounded-xl border border-slate-700 bg-slate-950/80 px-3 py-2 text-sm" />
            </div>

            <!-- Crr -->
            <div class="space-y-1 text-sm">
                <label class="text-slate-200">Rullemotstand (Crr)</label>
                <input id="crr" type="number" step="0.0001" value="0.004"
                       class="w-full rounded-xl border border-slate-700 bg-slate-950/80 px-3 py-2 text-sm" />
                <p class="text-xs text-slate-400">Vanlige dekk: 0.0035–0.0050</p>
            </div>

            <Button id="calcBtn" variant="primary">Beregn fart</Button>
        </div>

        <Card title="Resultat">
            <div id="result" class="text-sm text-slate-300">
                Fyll inn data og trykk «Beregn».
            </div>
        </Card>
    </div>

    <script type="module">
        const rho = 1.226; // vanlig lufttetthet
        const g = 9.81;

        const watt = document.getElementById("watt");
        const cda = document.getElementById("cda");
        const weight = document.getElementById("weight");
        const crr = document.getElementById("crr");
        const result = document.getElementById("result");

        function calc() {
            const W = Number(watt.value);
            const CdA = Number(cda.value);
            const m = Number(weight.value);
            const Crr = Number(crr.value);

            // vi løser med iterasjon
            let v = 5; // start, m/s
            for (let i = 0; i < 30; i++) {
                const aero = 0.5 * rho * CdA * v * v;
                const roll = m * g * Crr;
                const v_new = W / (aero + roll);
                v = 0.5 * (v + v_new);
            }

            const kmh = v * 3.6;

            result.innerHTML = `
        <p><strong>Fart:</strong> ${kmh.toFixed(1)} km/t</p>
      `;
        }

        document.getElementById("calcBtn").onclick = calc;
    </script>
</BaseLayout>