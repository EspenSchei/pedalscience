---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Button from "../../components/Button.astro";
import Card from "../../components/Card.astro";

const title = "Watts → Speed";
const description =
    "Calculate speed on flat ground based on watts, CdA, rolling resistance, and weight.";
---

<BaseLayout {title} {description}>
    <header class="mb-6">
        <h1 class="text-2xl font-semibold tracking-tight text-slate-900 sm:text-3xl">
            Watts → Speed
        </h1>

        <p class="mt-2 max-w-2xl text-sm text-slate-600">
            Calculator based on the balance between air resistance and rolling resistance. A
            realistic estimate for flat terrain.
        </p>
    </header>

    <div class="mt-4 grid gap-6 md:grid-cols-2">
        <div class="space-y-4">
            <!-- WATT -->
            <div class="space-y-1 text-sm">
                <label for="watt">Watts</label>
                <input id="watt" type="number" value="250" class="w-full" />
            </div>

            <!-- CdA -->
            <div class="space-y-1 text-sm">
                <label for="cda">CdA</label>
                <input id="cda" type="number" step="0.01" value="0.32" class="w-full" />
                <p class="text-xs text-slate-500">Typical road bike: 0.25–0.35</p>
            </div>

            <!-- WEIGHT -->
            <div class="space-y-1 text-sm">
                <label for="weight">Total weight (kg)</label>
                <input id="weight" type="number" step="0.1" value="82" class="w-full" />
            </div>

            <!-- Crr -->
            <div class="space-y-1 text-sm">
                <label for="crr">Rolling resistance (Crr)</label>
                <input id="crr" type="number" step="0.0001" value="0.004" class="w-full" />
                <p class="text-xs text-slate-500">Common tires: 0.0035–0.0050</p>
            </div>

            <div class="form-actions">
                <Button id="calcBtn" variant="primary">Calculate speed</Button>
            </div>
        </div>

        <Card title="Result">
            <div id="result" class="text-sm text-slate-600">
                Fill in data and click "Calculate".
            </div>
        </Card>
    </div>

    <script type="module">
        const rho = 1.226; // air density
        const g = 9.81;

        const watt = document.getElementById("watt");
        const cda = document.getElementById("cda");
        const weight = document.getElementById("weight");
        const crr = document.getElementById("crr");
        const result = document.getElementById("result");

        function calc() {
            const W = Number(watt.value);
            const CdA = Number(cda.value);
            const m = Number(weight.value);
            const Crr = Number(crr.value);

            // iterative solution
            let v = 5;
            for (let i = 0; i < 30; i++) {
                const aero = 0.5 * rho * CdA * v * v;
                const roll = m * g * Crr;
                const v_new = W / (aero + roll);
                v = 0.5 * (v + v_new);
            }

            const kmh = v * 3.6;

            result.innerHTML = `
        <p class="font-semibold text-slate-800">Speed:</p>
        <p class="text-slate-900">${kmh.toFixed(1)} km/h</p>
      `;
        }

        document.getElementById("calcBtn").onclick = calc;
    </script>
</BaseLayout>
