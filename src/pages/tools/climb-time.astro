---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Button from "../../components/Button.astro";
import Card from "../../components/Card.astro";

const title = "Climb Time Calculator";
const description =
    "Calculate how long it takes to climb a hill based on watts, weight, distance, and gradient.";
---

<BaseLayout {title} {description}>
    <header class="mb-6">
        <h1 class="text-2xl font-semibold tracking-tight text-slate-900 sm:text-3xl">
            Climb Time Calculator
        </h1>

        <p class="mt-2 max-w-2xl text-sm text-slate-600">
            Enter watts, total weight, distance, and gradient â€“ get estimated time and speed.
            The calculator uses a simplified model of gravitational force on climbs.
        </p>
    </header>

    <div class="mt-4 grid gap-6 md:grid-cols-2">
        <div class="space-y-4">
            <!-- WATT -->
            <div class="space-y-1 text-sm">
                <label for="watt">Watts</label>
                <input
                        id="watt"
                        type="number"
                        value="250"
                        class="w-full"
                />
            </div>

            <!-- WEIGHT -->
            <div class="space-y-1 text-sm">
                <label for="weight">Total weight (rider + bike)</label>
                <input
                        id="weight"
                        type="number"
                        step="0.1"
                        value="82"
                        class="w-full"
                />
            </div>

            <!-- DISTANCE -->
            <div class="space-y-1 text-sm">
                <label for="length">Distance (meters)</label>
                <input
                        id="length"
                        type="number"
                        value="2000"
                        class="w-full"
                />
            </div>

            <!-- GRADIENT -->
            <div class="space-y-1 text-sm">
                <label for="grade">Gradient (%)</label>
                <input
                        id="grade"
                        type="number"
                        value="6"
                        step="0.1"
                        class="w-full"
                />
            </div>

            <div class="form-actions">
                <Button id="calcBtn" variant="primary">
                    Calculate climb time
                </Button>
            </div>
        </div>

        <Card title="Result">
            <div id="result" class="text-sm text-slate-600">
                Fill in data and click "Calculate".
            </div>
        </Card>
    </div>

    <script type="module">
        const watt = document.getElementById("watt");
        const weight = document.getElementById("weight");
        const length = document.getElementById("length");
        const grade = document.getElementById("grade");
        const result = document.getElementById("result");

        const g = 9.81;

        function calc() {
            const W = Number(watt.value);
            const m = Number(weight.value);
            const dist = Number(length.value);
            const pct = Number(grade.value);

            if (!W || !m || !dist) {
                result.textContent = "Check input values.";
                return;
            }

            const theta = Math.atan(pct / 100);
            const v = W / (m * g * Math.sin(theta)); // m/s
            const time = dist / v;
            const kmh = v * 3.6;

            const min = Math.floor(time / 60);
            const sec = Math.round(time % 60);

            result.innerHTML = `
        <p class="font-semibold text-slate-800">Estimated time:</p>
        <p class="text-slate-900">${min} min ${sec} sec</p>
        <p class="mt-3 font-semibold text-slate-800">Average speed:</p>
        <p class="text-slate-900">${kmh.toFixed(1)} km/h</p>
      `;
        }

        document.getElementById("calcBtn").onclick = calc;
    </script>
</BaseLayout>
